@model ePaperLive.DBModel.Coupons

@{
    ViewBag.Title = "Add New Coupon";
}

    <div id="main">

        <!-- ======= Breadcrumbs ======= -->
        <section id="breadcrumbs" class="breadcrumbs">
            <div class="container">

                <ol>
                    <li><a href="@Url.Action("index", "home")">Home</a></li>
                    <li>@ViewData["Title"]</li>
                </ol>
                <h2>@ViewData["Title"]</h2>

            </div>
        </section><!-- End Breadcrumbs -->
        <!-- ======= Wizard Section ======= -->
        <section id="portfolio-details" class="portfolio-details">
            <div class="container">

                <div class="row gy-4">
                    <div class="col-lg-12">
                        <!-- start:wizrd -->

                        @using (Html.BeginForm())
                        {
                            @Html.AntiForgeryToken()

                        <div class="form-horizontal">
                            <hr />
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                        <div class="form-group col-md-5">
                            <div class="input-group py-2 ">
                                @* @Html.LabelFor(model => model.CouponCode, htmlAttributes: new { @class = "control-label col-md-2" })*@
                                    @Html.EditorFor(model => model.CouponCode, new { htmlAttributes = new { @class = "form-control" } })
                                    <button type="button" class="btn btn-danger btn-coupon-code">Generate Coupon Code</button>

                                    @Html.ValidationMessageFor(model => model.CouponCode, "", new { @class = "text-danger" })
                            </div>
                        </div>
                            

                            <div class="form-group col-md-5 py-2">
                                @Html.LabelFor(model => model.SubDays, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @*@Html.EditorFor(model => model.SubDays, new { htmlAttributes = new { @class = "form-control" } })*@
                                    @Html.HiddenFor(model => model.SubDays)
                                    @Html.DropDownList("SubDaysList", ViewBag.SubDaysList as SelectList, "Select days", new { @class = "form-control", id = "SubDaysList", @required = "required" })

                                    @Html.ValidationMessageFor(model => model.SubDays, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group col-md-5 py-2">
                                @Html.LabelFor(model => model.ExpiryDate, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.ExpiryDate, new { htmlAttributes = new { @class = "form-control",@type = "date"} })
                                    @Html.ValidationMessageFor(model => model.ExpiryDate, "", new { @class = "text-danger" })
                                </div>
                            </div>


                            <div class="form-group py-3">
                                <div class="col-md-offset-2 col-md-10">
                                    <input type="submit" value="Create Coupon" class="btn btn-sign-in" />
                                </div>
                            </div>
                        </div>
                        }

                        <div>
                            @Html.ActionLink("Back to List", "Index")
                        </div>
                        <!-- end:wizrd -->
                    </div>
                    

                </div>

            </div>
        </section><!-- End Wizard Section -->

    </div>
@section scripts {
    <script>

        $(document).ready(function () {
            $(".btn-coupon-code").on('click', function (e) {
                e.preventDefault();
                $('#originalAmount').val($("[name=CardAmount]").val());
                var couponCode = $("[name=couponCode]").val();
                if (couponCode != "") {
                    $('#loading').addClass('loading').removeClass('hidden');
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("GenerateCoupon", "Coupons")',
                        data: { couponCode : couponCode },
                        beforeSend: function () {
                            $('#loading').addClass('loading').removeClass('hidden');
                        },
                        success: function (result) {
                            $('#loading').addClass('hidden').removeClass('loading');
                            console.log(result.data);
                            $("[name=CouponCode]").val(result.data);
                        },
                        complete: function () {
                            $('#loading').addClass('hidden').removeClass('loading');
                        },
                    });
                }


            });

            $('#SubDaysList').on('change', (e) => {
                $('#SubDays').val($('#SubDaysList option:selected').text());
            });
        });

    </script>
    }
