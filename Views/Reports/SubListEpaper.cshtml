@model IEnumerable<ePaperLive.Models.EPaperSubscriberResult>

@{
    ViewBag.Title = "Epaper Subscription Report";
}

    <h2>Epaper Subscription</h2>
<div class="pt-5">
    <h2>Epaper Subscription Report</h2>
    @using (Html.BeginForm("EpaperSubList", "Admin/Reports", FormMethod.Post, new { @name = "epaperSubReport" }))
    {
        <div class="row p-4">
            <div class="col-lg-3 col-md-6 form-group">
                @Html.Label("Subscription:")
                @Html.DropDownList("subType", new SelectList(new[] {
                    new { Text = "Paid", Value = "Paid" },
                    new { Text = "Complimentary", Value = "Complimentary" }
                }, "Value", "Text"), "All", new { @class = "form-control" })
            </div>
            <div class="col-lg-3 col-md-6 form-group">
                @Html.Label("Start Date:")
                @Html.TextBox("startDate", null, new { @class = "form-control datepicker", @type = "date", @required = "required" })
            </div>
            <div class="col-lg-3 col-md-6 form-group">
                @Html.Label("End Date:")
                @Html.TextBox("endDate", null, new { @class = "form-control datepicker", @type = "date", @required = "required" })
            </div>
            <div class="col-lg-3 col-md-6 form-group">
                <button id="filterBtn" type="submit" class="btn btn-primary mt-4">Filter</button>
            </div>
        </div>
    }

    <table id="dataTable" class="table table-hover table-responsive table-striped small p-1">
        <caption id="dateRange">
            <strong>From:</strong> <span id="sDate"></span> - <strong>To:</strong> <span id="eDate"></span>
        </caption>
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.EmailAddress)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.StartDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.EndDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.SubType)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.PlanDesc)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.OrderNumber)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.InitialSubType)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.InitialOrderId)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.InitialCreated)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.InitialPlan)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.OldestTranxDate)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.FirstName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.LastName)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.AddressLine1)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.AddressLine2)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CityTown)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.StateParish)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.CountryCode)
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.EmailAddress)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.StartDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EndDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.SubType)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.PlanDesc)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.OrderNumber)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InitialSubType)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InitialOrderId)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InitialCreated)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InitialPlan)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.OldestTranxDate)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FirstName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.LastName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AddressLine1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.AddressLine2)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CityTown)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.StateParish)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.CountryCode)
                    </td>

                </tr>
            }
        </tbody>
        
    </table>
</div>
@Scripts.Render("~/bundles/jquery")
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />
<script>

    //$('[name=startDate]').val(moment().startOf('month').format('YYYY-MM-DD'));
    //$('[name=endDate]').val(moment().endOf('month').format('YYYY-MM-DD'));

    $('[name=startDate]').change(function (e) {
        var s = $(this).val();
        var sDate = moment(s).format('LL');
        $('#sDate').html(sDate);
    });

    $('[name=endDate]').change(function (e) {
        var d = $(this).val();
        var eDate = moment(d).format('LL');
        $('#eDate').html(eDate);
    });

    // Submit form on button click
    $('#filterBtn').click(function (e) {
        e.preventDefault();
        var orderNumber = $('#orderNumber').val();
        var startDate = $('[name=startDate]').val();
        var endDate = $('[name=endDate]').val();

        if (startDate == '' || endDate == '') {
            alert('Please select a start and end date.');
            return false;
        }

        if (moment(startDate).isAfter(endDate)) {
            alert('The end date must be after the start date.');
            return false;
        }

        // Submit form
        $('[name=epaperSubReport]').submit();
    });

</script>
<script>
    $(document).ready(function () {
        $('#sDate').html(moment($('[name=startDate]').val()).format('LL'));
        $('#eDate').html(moment($('[name=endDate]').val()).format('LL'));

        $('#dataTable').DataTable({
            pageLength: 25,
            dom: 'Bfrtip',
            buttons: [
                'excel', 'print'
            ]
        });
        //flatpickr('.datepicker', {
        //    dateFormat: "Y-m-d",
        //    disableMobile: true,
        //});
    });
</script>